(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-38",headers:{authorization:"dc5938bf-8ae4-4a63-a820-9dffc086b23d","Content-Type":"application/json"}},e="/cards",n="/users/me",r="/cards/likes";function o(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u={method:e,headers:t.headers};return c&&(n="".concat(n,"/").concat(c)),o&&(u.body=JSON.stringify(o)),fetch("".concat(t.baseUrl).concat(n),u).then((function(t){return t.ok?t.json():Promise.reject(new Error("".concat(r,": ").concat(t.status)))}))}var c=document.querySelector("#card-template").content;function u(t,e,n,r,o,u){var a=c.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),l=a.querySelector(".card__title"),s=a.querySelector(".card__like-button"),p=a.querySelector(".card__delete-button"),d=a.querySelector(".card__likes-number");return i.src=t.link,i.alt="Изображение места: ${cardData.name}",l.textContent=t.name,d.textContent=t.likes.length,i.addEventListener("click",(function(t){r(t)})),e?p.addEventListener("click",(function(e){u(e,t._id)})):p.style="display: none",n&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(e){o(e,s,t,d)})),a}function a(t,e,n,c){var u;e.classList.contains("card__like-button_is-active")?(u=n._id,o("DELETE",r,"Не удалось снять лайк",null,u)).then((function(e){c.textContent=e.likes.length,i(t)})).catch((function(t){return console.log(t)})):function(t){return o("PUT",r,"Не удалось поставить лайк",null,t)}(n._id).then((function(e){c.textContent=e.likes.length,i(t)})).catch((function(t){return console.log(t)}))}function i(t){t.target.classList.toggle("card__like-button_is-active")}function l(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",p),t.addEventListener("click",d)}function s(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p),t.removeEventListener("click",d)}function p(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&s(e)}}function d(t){(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close"))&&s(t.currentTarget)}function f(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent="",r.classList.remove(n.errorClass),e.classList.remove(n.inputErrorClass)}function _(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function m(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));_(n,t.querySelector(e.submitButtonSelector),e),n.forEach((function(n){return f(t,n,e)}))}function y(t){t.querySelector(".popup__error").textContent=""}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var S=document.querySelector(".places__list"),h=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),q=b.querySelector(".popup__button"),g=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".popup_type_edit form"),L=document.querySelector(".profile__image"),k=document.querySelector(".popup__input_type_name"),x=document.querySelector(".popup__input_type_description"),A=document.querySelector(".popup_type_avatar"),T=A.querySelector(".popup__button"),w=document.querySelector(".popup_type_avatar form"),D=document.querySelector(".popup__input_type_avatar"),j=document.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_new-card form"),O=document.querySelector(".popup__input_type_card-name"),P=document.querySelector(".popup__input_type_url"),U=document.querySelector(".popup_type_new-card"),M=U.querySelector(".popup__button"),H=document.querySelector(".popup_type_image"),I=document.querySelector(".popup__image"),R=document.querySelector(".popup__caption"),G=document.querySelector(".popup_type_confirm"),N=document.querySelector(".popup_type_confirm form"),V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},$=o("GET",n,"Не удалось получить данные пользователя"),z=o("GET",e,"Не удалось загрузить карточки");function F(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function J(t){l(H),I.src=t.target.src,I.alt=t.target.alt,R.textContent=t.target.closest(".card").textContent}function W(t,e){e.querySelector(".popup__error").textContent=t}function K(t,n){l(G),y(G),N.onsubmit=function(r){r.preventDefault(),function(t){return o("DELETE",e,"Не удалось удалить карточку",null,t)}(n).then((function(){s(G),t.target.closest(".card").remove()})).catch((function(t){return W(t,G)}))}}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);_(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?f(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));o.textContent=n,o.classList.add(r.errorClass),e.classList.add(r.inputErrorClass)}(t,e,e.validationMessage,n)}(t,o,e),_(n,r,e)}))}))}(e,t)}))}(V),Promise.all([$,z]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];g.textContent=o.name,E.textContent=o.about,L.style="background-image: url(".concat(o.avatar,")"),c.forEach((function(t){var e=t.owner._id===o._id,n=t.likes.some((function(t){return t._id===o._id}));S.append(u(t,e,n,J,a,K))}))})).catch((function(t){console.log(t)})),h.addEventListener("click",(function(){l(b),k.value=g.textContent,x.value=E.textContent,m(C,V),y(b)})),C.addEventListener("submit",(function(t){var e,r;t.preventDefault(),F(!0,q),(e=k.value,r=x.value,o("PATCH",n,"Не удалось обновить профиль",{name:e,about:r})).then((function(t){g.textContent=t.name,E.textContent=t.about,s(b)})).catch((function(t){return W(t,b)})).finally((function(){return F(!1,q)}))})),L.addEventListener("click",(function(t){l(A),D.value="",m(w,V),y(A)})),w.addEventListener("submit",(function(t){var e;t.preventDefault(),F(!0,T),(e=D.value,fetch(e,{method:"HEAD"}).then((function(t){var e=t.headers.get("Content-Type");if(t.ok&&e&&e.startsWith("image/"))return!0;throw new Error("URL не подходит: ".concat(t.status))}))).then((function(){return o("PATCH","/users/me/avatar","Не удалось изменить аватар профиля",{avatar:D.value})})).then((function(t){L.style="background-image: url(".concat(t.avatar,")"),s(A)})).catch((function(t){t instanceof TypeError&&"Failed to fetch"===t.message?W("Ошибка сети или блокировка CORS. Проверьте URL.",A):W(t.message||"Произошла неизвестная ошибка",A)})).finally((function(){F(!1,T)}))})),j.addEventListener("click",(function(){l(U),m(B,V),y(U),B.reset()})),B.addEventListener("submit",(function(t){t.preventDefault(),F(!0,M);var n,r,c={name:O.value,link:P.value};(n=c.name,r=c.link,o("POST",e,"Не удалось добавить карточку",{name:n,link:r})).then((function(t){S.prepend(u(t,!0,!1,J,a,K)),s(U),B.reset()})).catch((function(t){return W(t,U)})).finally((function(){return F(!1,M)}))}))})();