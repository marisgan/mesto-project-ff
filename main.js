(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-38",headers:{authorization:"dc5938bf-8ae4-4a63-a820-9dffc086b23d","Content-Type":"application/json"}},e="/cards",n="/users/me",r="/cards/likes";function o(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u={method:e,headers:t.headers};return c&&(n="".concat(n,"/").concat(c)),o&&(u.body=JSON.stringify(o)),fetch("".concat(t.baseUrl).concat(n),u).then((function(t){return t.ok?t.json():Promise.reject(new Error("".concat(r,": ").concat(t.status)))}))}var c=document.querySelector("#card-template").content;function u(t,e,n,r,o,u){var a=c.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),l=a.querySelector(".card__title"),s=a.querySelector(".card__like-button"),p=a.querySelector(".card__delete-button"),d=a.querySelector(".card__likes-number");return i.src=t.link,i.alt="Изображение места: ${cardData.name}",l.textContent=t.name,d.textContent=t.likes.length,i.addEventListener("click",(function(t){r(t)})),e?p.addEventListener("click",(function(e){u(e,t._id)})):p.style="display: none",n&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(e){o(e,s,t,d)})),a}function a(t,e,n,c){var u;e.classList.contains("card__like-button_is-active")?(u=n._id,o("DELETE",r,"Не удалось снять лайк",null,u)).then((function(e){c.textContent=e.likes.length,i(t)})).catch((function(t){return console.log(t)})):function(t){return o("PUT",r,"Не удалось поставить лайк",null,t)}(n._id).then((function(e){c.textContent=e.likes.length,i(t)})).catch((function(t){return console.log(t)}))}function i(t){t.target.classList.toggle("card__like-button_is-active")}function l(t){t.querySelector(".popup__error").textContent="",t.classList.add("popup_is-opened"),document.addEventListener("keydown",p),t.addEventListener("click",d)}function s(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p),t.removeEventListener("click",d)}function p(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&s(e)}}function d(t){(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close"))&&s(t.currentTarget)}function f(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent="",r.classList.remove(n.errorClass),e.classList.remove(n.inputErrorClass)}function _(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function m(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));_(n,t.querySelector(e.submitButtonSelector),e),n.forEach((function(n){return f(t,n,e)}))}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var v=document.querySelector(".places__list"),S=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),b=h.querySelector(".popup__button"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),E=document.querySelector(".popup_type_edit form"),C=document.querySelector(".profile__image"),L=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_avatar"),A=x.querySelector(".popup__button"),T=document.querySelector(".popup_type_avatar form"),w=document.querySelector(".popup__input_type_avatar"),D=document.querySelector(".profile__add-button"),j=document.querySelector(".popup_type_new-card form"),B=document.querySelector(".popup__input_type_card-name"),O=document.querySelector(".popup__input_type_url"),P=document.querySelector(".popup_type_new-card"),U=P.querySelector(".popup__button"),M=document.querySelector(".popup_type_image"),H=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),R=document.querySelector(".popup_type_confirm"),G=document.querySelector(".popup_type_confirm form"),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},V=o("GET",n,"Не удалось получить данные пользователя"),$=o("GET",e,"Не удалось загрузить карточки");function z(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function F(t){l(M),H.src=t.target.src,H.alt=t.target.alt,I.textContent=t.target.closest(".card").textContent}function J(t,e){e.querySelector(".popup__error").textContent=t}function W(t,n){l(R),G.onsubmit=function(r){r.preventDefault(),function(t){return o("DELETE",e,"Не удалось удалить карточку",null,t)}(n).then((function(){s(R),t.target.closest(".card").remove()})).catch((function(t){return J(t,R)}))}}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);_(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?f(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));o.textContent=n,o.classList.add(r.errorClass),e.classList.add(r.inputErrorClass)}(t,e,e.validationMessage,n)}(t,o,e),_(n,r,e)}))}))}(e,t)}))}(N),Promise.all([V,$]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];q.textContent=o.name,g.textContent=o.about,C.style="background-image: url(".concat(o.avatar,")"),c.forEach((function(t){var e=t.owner._id===o._id,n=t.likes.some((function(t){return t._id===o._id}));v.append(u(t,e,n,F,a,W))}))})).catch((function(t){console.log(t)})),S.addEventListener("click",(function(){l(h),L.value=q.textContent,k.value=g.textContent,m(E,N)})),E.addEventListener("submit",(function(t){var e,r;t.preventDefault(),z(!0,b),(e=L.value,r=k.value,o("PATCH",n,"Не удалось обновить профиль",{name:e,about:r})).then((function(t){q.textContent=t.name,g.textContent=t.about,s(h)})).catch((function(t){return J(t,h)})).finally((function(){return z(!1,b)}))})),C.addEventListener("click",(function(t){l(x),w.value="",m(T,N)})),T.addEventListener("submit",(function(t){var e;t.preventDefault(),z(!0,A),(e=w.value,fetch(e,{method:"HEAD"}).then((function(t){var e=t.headers.get("Content-Type");if(t.ok&&e&&e.startsWith("image/"))return!0;throw new Error("URL не подходит: ".concat(t.status))}))).then((function(){return o("PATCH","/users/me/avatar","Не удалось изменить аватар профиля",{avatar:w.value})})).then((function(t){C.style="background-image: url(".concat(t.avatar,")"),s(x)})).catch((function(t){t instanceof TypeError&&"Failed to fetch"===t.message?J("Ошибка сети или блокировка CORS. Проверьте URL.",x):J(t.message||"Произошла неизвестная ошибка",x)})).finally((function(){z(!1,A)}))})),D.addEventListener("click",(function(){l(P),m(j,N),j.reset()})),j.addEventListener("submit",(function(t){t.preventDefault(),z(!0,U);var n,r,c={name:B.value,link:O.value};(n=c.name,r=c.link,o("POST",e,"Не удалось добавить карточку",{name:n,link:r})).then((function(t){v.prepend(u(t,!0,!1,F,a,W)),s(P),j.reset()})).catch((function(t){return J(t,P)})).finally((function(){return z(!1,U)}))}))})();